# Техническая документация

## Назначение

Программа представляет собой графический текстовый редактор на языке C++ с использованием библиотеки **FLTK**. Она реализует функции создания, открытия, сохранения, редактирования текста, поиска и замены. Поддерживаются диалоговые окна и стандартные команды редактирования.

---

## Основные компоненты

### 1. **Класс `EditorWindow`**

Главное окно редактора, наследует `Fl_Double_Window`:

- Отображает текстовое поле (`Fl_Text_Editor`).
- Содержит меню и диалоговые окна поиска и замены.
- Содержит обработчики событий `draw`, `handle`, `resize`.

### 2. **Буфер `Fl_Text_Buffer`**

Используется для хранения текста, редактируемого в окне редактора:

```cpp
Fl_Text_Buffer* textbuf;
```

### 3. **Меню**

Создаётся в `EditorWindow::EditorWindow` через `Fl_Menu_Bar`:

- Файл: Новый, Открыть, Сохранить, Сохранить как, Выход
- Правка: Вырезать, Копировать, Вставить, Удалить
- Поиск: Найти, Заменить

---

## Диалоговые окна

### `find_dlg`

- Поиск текста (одиночное совпадение).
- Включает: `Fl_Input`, `Fl_Return_Button`, `Fl_Button`

### `replace_dlg`

- Замена текста (одно или все совпадения).
- Включает: 2 `Fl_Input`, `Fl_Return_Button`, `Fl_Button`

---

## Глобальные переменные

```cpp
int changed = 0;           // Флаг изменения текста
std::string filename;      // Имя текущего файла
int loading = 0;           // Флаг загрузки файла
```

---

## Основные функции

### Файловые:

- `save_file(char* newfile)` — сохраняет содержимое `textbuf` в файл.
- `load_file(char* newfile, int ipos)` — загружает текст из файла.
- `check_save()` — спрашивает пользователя о сохранении при изменениях.

### Обработка меню:

- `new_cb`, `open_cb`, `save_cb`, `saveas_cb`, `quit_cb` — операции с файлами.
- `cut_cb`, `copy_cb`, `paste_cb`, `delete_cb` — операции редактирования.

### Поиск и замена:

- `find_cb` — показать окно поиска.
- `find2_cb` — найти следующее вхождение.
- `replace_cb` — показать окно замены.
- `replace_find_next_cb` — найти следующее в окне замены.
- `replace_all_cb` — заменить все совпадения.

### Служебные:

- `changed_cb()` — устанавливает флаг изменения при модификации текста.
- `hide_find_cb()` / `hide_replace_cb()` — скрывают соответствующие окна.

---

## Структура `main`

```cpp
int main(int argc, char **argv) {
    textbuf = new Fl_Text_Buffer;
    textbuf->add_modify_callback(changed_cb, nullptr);

    EditorWindow* window = new_view();
    if (argc > 1) load_file(argv[1], -1);
    return Fl::run();
}
```

- Создаёт текстовый буфер и окно.
- Загружает файл при передаче в аргументах.
- Запускает главный цикл FLTK.

---

## Особенности реализации

- Используется `Fl_Text_Editor` как основное поле редактирования.
- Все команды меню используют callback-функции.
- Реализована поддержка горячих клавиш (`FL_COMMAND + key`).
- Работа с буфером `textbuf` синхронизирована с интерфейсом.

---

## Модификация

Мой код неидентичен с тем, что находится в [гайде](https://www.fltk.org/doc-1.1/editor.html). Например, меню у меня сделано через метод add(), а не через массив menuitems[]. Также добавлено диалоговое окно для поиска и сделаны по-другому. Изменены функции find2_cb и save_file(). Добавлены callback-функции для скрытия диалогов hide_find_cb, hide_replace_cb
